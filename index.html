<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KOOBERA - Frontend Explanation</title>

  <!-- icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #0a0a1a;
      --secondary: #0f1538;
      --accent: #1a237e;
      --quantum: #00e5ff;
      --highlight: #7c4dff;
      --success: #00e676;
      --warning: #ffeb3b;
      --danger: #ff1744;
      --text: #e0e0e0;
      --card-bg: rgba(26, 35, 126, 0.18);
      --glow: 0 0 10px rgba(124, 77, 255, 0.07);
      --glass-border: rgba(124, 77, 255, 0.22);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; }
    html,body { height: 100%; }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg,var(--primary),var(--secondary));
      color: var(--text);
      padding: 18px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    header {
      text-align: center;
      padding: 22px 10px;
      border-bottom: 1px solid rgba(124,77,255,0.14);
      margin-bottom: 26px;
    }
    .logo { display:flex; align-items:center; justify-content:center; gap:14px; }
    .logo-icon { font-size: 44px; color:var(--quantum); animation: pulse 2s infinite; }
    .logo h1 {
      font-size: 36px;
      margin: 0;
      background: linear-gradient(90deg,var(--quantum),var(--highlight));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
      letter-spacing: 1px;
    }
    @keyframes pulse { 0%{ text-shadow:0 0 4px rgba(0,229,255,0.2);} 50%{ text-shadow:0 0 20px rgba(0,229,255,0.35);} 100%{ text-shadow:0 0 4px rgba(0,229,255,0.2);} }

    .tagline { color:var(--quantum); opacity:0.95; margin-top:8px; font-weight:600; }

    .top-row { display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap; margin:18px 0; }
    /* left column: login + trade form */
    .left-col { width: 320px; min-width:260px; }
    .card { background:var(--card-bg); border-radius:12px; padding:18px; box-shadow:var(--glow); border:1px solid var(--glass-border); }
    .card + .card { margin-top:14px; }

    /* login box */
    #loginBox input { width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:none; }
    #loginBox button { width:100%; padding:10px 12px; border-radius:8px; border:none; background:linear-gradient(90deg,var(--highlight),var(--quantum)); color:#fff; font-weight:700; cursor:pointer; }
    #logoutBtn { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); margin-top:8px; }

    /* trade form */
    #tradeForm input, #tradeForm select { width:100%; padding:10px 12px; margin:8px 0; border-radius:8px; border:none; }
    #tradeForm button { width:100%; padding:10px 12px; border-radius:8px; border:none; background:linear-gradient(90deg,var(--highlight),var(--quantum)); color:#fff; font-weight:700; cursor:pointer; }

    /* main content / cards */
    .main-col { flex:1; min-width: 320px; }
    .content { display:grid; grid-template-columns:1fr; gap:20px; }

    .card-title { display:flex; align-items:center; gap:10px; color:var(--quantum); font-weight:700; font-size:16px; margin-bottom:12px; border-bottom:1px solid rgba(124,77,255,0.08); padding-bottom:8px; }

    .explanation { background: rgba(10,10,26,0.7); border-radius:10px; padding:14px; border:1px solid rgba(124,77,255,0.06); }
    .key-point { display:flex; gap:10px; margin:10px 0; align-items:flex-start; }
    .example { background:rgba(0,0,0,0.25); padding:12px; border-radius:8px; margin-top:12px; border-left:4px solid var(--quantum); }

    .comparison-table { width:100%; border-collapse:collapse; margin-top:12px; }
    .comparison-table th, .comparison-table td { padding:8px 10px; border-bottom:1px solid rgba(124,77,255,0.06); text-align:left; font-size:14px; }
    .correct { color:var(--success); font-weight:700; }
    .incorrect { color:var(--danger); font-weight:700; }

    /* trades list */
    #tradesList { margin-top:14px; border-radius:10px; padding:12px; background:rgba(10,10,26,0.7); border:1px solid rgba(124,77,255,0.06); }
    #tradesList h3 { color:var(--quantum); margin-bottom:10px; }
    .tradeItem { display:flex; justify-content:space-between; gap:12px; align-items:center; padding:10px 8px; border-bottom:1px solid rgba(124,77,255,0.04); }
    .tradeItem:last-child { border-bottom:none; }
    .tradeLeft { display:flex; flex-direction:column; gap:6px; }
    .tradeMain { font-weight:700; }
    .tradeMeta { font-size:12px; opacity:0.75; }
    .tradeActions { display:flex; gap:8px; align-items:center; }
    .btn { padding:6px 10px; border-radius:6px; border:none; cursor:pointer; font-weight:600; }
    .editBtn { background:linear-gradient(90deg,var(--highlight),var(--quantum)); color:#fff; }
    .deleteBtn { background:var(--danger); color:#fff; }
    .saveBtn { background:var(--success); color:#012; }
    .cancelBtn { background:#333; color:#fff; }

    .inlineInput { padding:6px 8px; border-radius:6px; border:none; width:110px; }

    .small { font-size:13px; opacity:0.85; }

    .footer { text-align:center; margin-top:26px; padding:18px 10px; border-top:1px solid rgba(124,77,255,0.08); font-size:13px; opacity:0.8; }
    @media (max-width:900px) {
      .top-row { flex-direction:column; }
      .left-col { width:100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon"><i class="fas fa-atom"></i></div>
        <h1>KOOBERA</h1>
      </div>
      <div class="tagline">AI-powered trading analysis â€” frontend explanation</div>
      <div style="margin-top:8px; font-size:13px; opacity:0.8;">Use this page to login, save trade calls, and view/edit them. AI backend plugs into Firestore later.</div>
    </header>

    <div class="top-row">
      <!-- LEFT COLUMN: Login + Trade Form -->
      <div class="left-col">
        <div class="card" id="loginBox">
          <div style="font-weight:800; color:var(--quantum); margin-bottom:8px;"><i class="fas fa-user-circle"></i> Account</div>
          <input id="email" type="email" placeholder="Email (you@example.com)" />
          <input id="password" type="password" placeholder="Password" />
          <button id="loginBtn">Login</button>
          <button id="logoutBtn" style="display:none; margin-top:8px;">Logout</button>
          <p id="loginStatus" class="small" style="margin-top:10px;">Not logged in</p>
        </div>

        <div class="card" id="tradeForm">
          <div style="font-weight:800; color:var(--quantum); margin-bottom:8px;"><i class="fas fa-plus-circle"></i> Add Trade Call</div>
          <input id="symbolInput" type="text" placeholder="Stock Symbol (e.g. RELIANCE)" />
          <input id="priceInput" type="number" step="0.01" placeholder="Price (e.g. 2500.00)" />
          <select id="actionInput">
            <option value="BUY">BUY</option>
            <option value="SELL">SELL</option>
            <option value="HOLD">HOLD</option>
          </select>
          <button id="saveBtn">Save Trade Call</button>
        </div>
      </div>

      <!-- MAIN COLUMN: Cards -->
      <div class="main-col">
        <div class="content">
          <!-- Card 1 -->
          <div class="card">
            <div class="card-title"><i class="fas fa-project-diagram"></i> Pattern Strength Explained</div>
            <div class="explanation">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-weight:700; color:var(--quantum);"><i class="fas fa-wave-square"></i> What is Pattern Strength?</div>
              </div>
              <div style="margin-top:10px; line-height:1.6;">
                <p>Pattern Strength is a metric that measures the clarity and reliability of technical chart patterns identified by KOOBERA's analysis algorithms.</p>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Score Range:</strong> 0-10 (10 being the strongest pattern)</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Calculation:</strong> Based on pattern completeness, volume confirmation, and historical accuracy</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Interpretation:</strong> Higher scores indicate more reliable trading signals</div>
                </div>

                <div class="example">
                  <div style="font-weight:700; color:var(--quantum);">Example Patterns:</div>
                  <p><strong>High Pattern Strength (8-10):</strong> Clear head and shoulders, cup and handle, or double bottom patterns with volume confirmation</p>
                  <p><strong>Medium Pattern Strength (4-7):</strong> Developing patterns that need confirmation</p>
                  <p><strong>Low Pattern Strength (0-3):</strong> Weak or incomplete patterns with low predictive value</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 2 -->
          <div class="card">
            <div class="card-title"><i class="fas fa-database"></i> Real-Time Data Integration</div>
            <div class="explanation">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-weight:700; color:var(--quantum);"><i class="fas fa-sync-alt"></i> Will KOOBERA show real stock prices?</div>
              </div>
              <div style="margin-top:10px; line-height:1.6;">
                <p>Yes â€” once connected to real-time NSE/BSE or other market data feeds, KOOBERA will display actual market prices and updates.</p>

                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Live Prices:</strong> Real-time stock prices from exchanges</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Market Data:</strong> Volume, bid-ask spread, and other market metrics</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Automatic Updates:</strong> Prices update automatically without page refresh</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Historical Data:</strong> Access to historical prices for backtesting and analysis</div>
                </div>

                <div class="example">
                  <div style="font-weight:700; color:var(--quantum);">Implementation:</div>
                  <p>KOOBERA will connect to market data APIs and streaming endpoints (WebSocket) for real-time data.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 3 -->
          <div class="card">
            <div class="card-title"><i class="fas fa-brain"></i> Unified Analysis Recommendations</div>
            <div class="explanation">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-weight:700; color:var(--quantum);"><i class="fas fa-chart-line"></i> How recommendations work</div>
              </div>
              <div style="margin-top:10px; line-height:1.6;">
                <p>KOOBERA's Unified Analysis provides <strong>objective recommendations</strong> based on algorithmic analysis, not user input.</p>

                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Independent Analysis:</strong> Recommendations are generated by the algorithm regardless of user selection</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>User Call Comparison:</strong> The system compares your selection with its analysis</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Confidence Scoring:</strong> Each recommendation includes a confidence percentage</div>
                </div>

                <table class="comparison-table">
                  <thead>
                    <tr><th>User Selection</th><th>KOOBERA Analysis</th><th>Result</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Buy</td><td>Buy</td><td class="correct">Alignment - Proceed with trade</td></tr>
                    <tr><td>Buy</td><td>Sell</td><td class="incorrect">Misalignment - Reconsider trade</td></tr>
                    <tr><td>Sell</td><td>Hold</td><td class="incorrect">Partial misalignment - Wait</td></tr>
                  </tbody>
                </table>

                <div class="example">
                  <div style="font-weight:700; color:var(--quantum);">Example Scenario:</div>
                  <p>If you select "BUY" for RELIANCE but KOOBERA's analysis shows "SELL" at 95% confidence â€” the platform alerts you and explains the reasoning.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 4 -->
          <div class="card">
            <div class="card-title"><i class="fas fa-lightbulb"></i> How to Interpret KOOBERA's Analysis</div>
            <div class="explanation">
              <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="font-weight:700; color:var(--quantum);"><i class="fas fa-analytics"></i> Making the Most of KOOBERA</div>
              </div>
              <div style="margin-top:10px; line-height:1.6;">
                <p>KOOBERA is designed to enhance trading decisions, not replace them. Use the tool to validate ideas and manage risk.</p>

                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Use as confirmation:</strong> Validate your trade ideas with KOOBERA's analysis</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Confidence levels:</strong> Higher scores indicate more reliable signals</div>
                </div>
                <div class="key-point"><i class="fas fa-check-circle" style="color:var(--quantum);"></i>
                  <div><strong>Combine with fundamentals:</strong> Use KOOBERA alongside news and fundamental research</div>
                </div>

                <div class="example">
                  <div style="font-weight:700; color:var(--quantum);">Remember:</div>
                  <p>No system guarantees 100% accuracy. Use proper risk management, diversify, and consult advisors for major moves.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Trades list card -->
          <div class="card" id="tradesCard">
            <div class="card-title"><i class="fas fa-list"></i> Your Trades</div>
            <div id="tradesList">
              <h3>ðŸ“Š My Trade Calls</h3>
              <div id="tradesContainer" class="small">Login to see your saved trades.</div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="footer">
      KOOBERA &copy; 2023 â€” Advanced Trading Analysis Platform. This frontend demonstrates login, trade saving, inline edit & delete using Firebase.
    </div>
  </div>

  <!-- Firebase compat SDKs (auth + firestore) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    /*****************************************************************
     * Replace the firebaseConfig below with your project's config.
     * You already used this earlier; keep the same values from your
     * Firebase console -> Project settings -> SDK setup.
     *****************************************************************/
    const firebaseConfig = {
      apiKey: "AIzaSyBIKa4CwfDeE7juzMtiKeIx8mC8YJ5Qn0",
      authDomain: "toptter-trading.firebaseapp.com",
      projectId: "toptter-trading",
      storageBucket: "toptter-trading.appspot.com",
      messagingSenderId: "747829253190",
      appId: "1:747829253190:web:ccce57e5ea5d3f6be36647"
    };

    // initialize
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- UI elements
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const emailEl = document.getElementById("email");
    const passwordEl = document.getElementById("password");
    const loginStatus = document.getElementById("loginStatus");

    const saveBtn = document.getElementById("saveBtn");
    const symbolInput = document.getElementById("symbolInput");
    const priceInput = document.getElementById("priceInput");
    const actionInput = document.getElementById("actionInput");

    const tradesContainer = document.getElementById("tradesContainer");

    let currentSnapshotUnsubscribe = null; // to store onSnapshot unsubscribe

    // --- Authentication handlers
    loginBtn.addEventListener("click", async () => {
      const email = emailEl.value.trim();
      const pw = passwordEl.value;
      if (!email || !pw) { alert("Enter email and password"); return; }
      try {
        await auth.signInWithEmailAndPassword(email, pw);
      } catch (err) {
        // if user doesn't exist, offer to create account
        if (err.code === "auth/user-not-found") {
          const shouldCreate = confirm("User not found. Create new account with this email?");
          if (shouldCreate) {
            try {
              await auth.createUserWithEmailAndPassword(email, pw);
              alert("Account created. You're logged in.");
            } catch (e2) {
              alert("Could not create account: " + e2.message);
            }
          }
        } else {
          alert("Login error: " + err.message);
        }
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await auth.signOut();
    });

    // --- Auth state listener
    auth.onAuthStateChanged(user => {
      if (user) {
        loginStatus.innerText = "âœ… Logged in as " + (user.email || "(no email)");
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";

        // Start listening to user's trades
        startListeningTrades(user.uid);
      } else {
        loginStatus.innerText = "âŒ Not logged in";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";

        // stop previous listener if any
        if (currentSnapshotUnsubscribe) {
          currentSnapshotUnsubscribe();
          currentSnapshotUnsubscribe = null;
        }
        tradesContainer.innerHTML = "Login to see your saved trades.";
      }
    });

    // --- Save trade call
    saveBtn.addEventListener("click", saveTradeCall);
    async function saveTradeCall() {
      const user = auth.currentUser;
      if (!user) { alert("Please log in first"); return; }

      const symbol = symbolInput.value.trim();
      const price = parseFloat(priceInput.value);
      const action = actionInput.value;

      if (!symbol || isNaN(price)) { alert("Enter valid symbol and price"); return; }

      try {
        await db.collection("Users").doc(user.uid).collection("tradeCalls").add({
          symbol,
          price,
          action,
          createdBy: user.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        // clear form
        symbolInput.value = "";
        priceInput.value = "";
        actionInput.value = "BUY";
      } catch (err) {
        alert("Failed to save trade: " + err.message);
      }
    }

    // --- Listen and render trades (uses real-time listener)
    function startListeningTrades(uid) {
      // stop previous listener
      if (currentSnapshotUnsubscribe) currentSnapshotUnsubscribe();

      const colRef = db.collection("Users").doc(uid).collection("tradeCalls").orderBy("createdAt", "desc");
      currentSnapshotUnsubscribe = colRef.onSnapshot(snapshot => {
        renderTradesSnapshot(uid, snapshot);
      }, err => {
        console.error("Snapshot error:", err);
        tradesContainer.innerHTML = "Error loading trades: " + err.message;
      });
    }

    // Utility: friendly timestamp
    function friendlyTime(ts) {
      if (!ts) return "";
      // ts may be a Firestore Timestamp or a plain value
      try {
        if (ts.toDate) return ts.toDate().toLocaleString();
        if (typeof ts === "object" && ts.seconds) return new Date(ts.seconds * 1000).toLocaleString();
        return new Date(ts).toLocaleString();
      } catch (e) {
        return "";
      }
    }

    // Render the snapshot into DOM. Uses event listeners (no inline onclick) for safety.
    function renderTradesSnapshot(uid, snapshot) {
      if (snapshot.empty) {
        tradesContainer.innerHTML = "No trades saved yet.";
        return;
      }
      tradesContainer.innerHTML = ""; // clear

      snapshot.forEach(doc => {
        const data = doc.data();
        const id = doc.id;

        // main container
        const item = document.createElement("div");
        item.className = "tradeItem";
        item.dataset.docId = id;

        // left details
        const left = document.createElement("div");
        left.className = "tradeLeft";

        const main = document.createElement("div");
        main.className = "tradeMain";
        main.textContent = `${data.action || ""} ${data.symbol || ""} @ ${data.price ?? ""}`;

        const meta = document.createElement("div");
        meta.className = "tradeMeta small";
        meta.textContent = `Saved: ${friendlyTime(data.createdAt)}`;

        left.appendChild(main);
        left.appendChild(meta);

        // actions container
        const actions = document.createElement("div");
        actions.className = "tradeActions";

        // Edit button
        const editBtn = document.createElement("button");
        editBtn.className = "btn editBtn";
        editBtn.innerHTML = "<i class='fas fa-edit'></i> Edit";
        editBtn.addEventListener("click", () => enterInlineEdit(item, uid, id, data));

        // Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn deleteBtn";
        deleteBtn.innerHTML = "<i class='fas fa-trash'></i> Delete";
        deleteBtn.addEventListener("click", async () => {
          const ok = confirm("Delete this trade?");
          if (!ok) return;
          try {
            await db.collection("Users").doc(uid).collection("tradeCalls").doc(id).delete();
          } catch (err) {
            alert("Delete failed: " + err.message);
          }
        });

        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);

        item.appendChild(left);
        item.appendChild(actions);

        tradesContainer.appendChild(item);
      });
    }

    // --- Inline edit UI
    function enterInlineEdit(itemEl, uid, docId, oldData) {
      // replace left side with inputs
      const left = itemEl.querySelector(".tradeLeft");
      const actions = itemEl.querySelector(".tradeActions");

      // backup original innerHTML to restore on cancel if needed
      const backupLeft = left.innerHTML;
      const backupActions = actions.innerHTML;

      left.innerHTML = ""; // clear

      // create inputs
      const symbolIn = document.createElement("input");
      symbolIn.className = "inlineInput";
      symbolIn.value = oldData.symbol || "";
      symbolIn.placeholder = "Symbol";

      const priceIn = document.createElement("input");
      priceIn.className = "inlineInput";
      priceIn.type = "number";
      priceIn.step = "0.01";
      priceIn.value = oldData.price ?? "";
      priceIn.placeholder = "Price";

      const actionSel = document.createElement("select");
      actionSel.className = "inlineInput";
      ["BUY","SELL","HOLD"].forEach(opt => {
        const o = document.createElement("option");
        o.value = opt;
        o.textContent = opt;
        if ((oldData.action || "").toUpperCase() === opt) o.selected = true;
        actionSel.appendChild(o);
      });

      // layout small
      const row = document.createElement("div");
      row.style.display = "flex";
      row.style.gap = "8px";
      row.style.alignItems = "center";
      row.appendChild(actionSel);
      row.appendChild(symbolIn);
      row.appendChild(priceIn);

      // timestamp below
      const ts = document.createElement("div");
      ts.className = "tradeMeta small";
      ts.style.marginTop = "6px";
      ts.textContent = `Saved: ${friendlyTime(oldData.createdAt)}`;

      left.appendChild(row);
      left.appendChild(ts);

      // replace actions with Save + Cancel
      actions.innerHTML = "";

      const saveBtn = document.createElement("button");
      saveBtn.className = "btn saveBtn";
      saveBtn.textContent = "Save";
      saveBtn.addEventListener("click", async () => {
        const newSymbol = symbolIn.value.trim();
        const newPrice = parseFloat(priceIn.value);
        const newAction = actionSel.value;

        if (!newSymbol || isNaN(newPrice)) { alert("Enter valid symbol & price"); return; }

        try {
          await db.collection("Users").doc(uid).collection("tradeCalls").doc(docId).update({
            symbol: newSymbol,
            price: newPrice,
            action: newAction,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          // no need to manually revert UI: snapshot will re-render; but we can show a small message if desired
        } catch (err) {
          alert("Update failed: " + err.message);
        }
      });

      const cancelBtn = document.createElement("button");
      cancelBtn.className = "btn cancelBtn";
      cancelBtn.textContent = "Cancel";
      cancelBtn.addEventListener("click", () => {
        // restore backed-up content
        left.innerHTML = backupLeft;
        actions.innerHTML = backupActions;

        // reattach original event listeners for edit/delete (they were lost when we restored innerHTML)
        // easiest approach: re-render this specific doc by forcing a snapshot refresh (but snapshot will update anyway).
        // For immediate fix, rebind events by finding buttons within actions
        const editNow = actions.querySelector(".editBtn");
        const deleteNow = actions.querySelector(".deleteBtn");
        if (editNow) {
          editNow.addEventListener("click", () => enterInlineEdit(itemEl, uid, docId, oldData));
        }
        if (deleteNow) {
          deleteNow.addEventListener("click", async () => {
            const ok = confirm("Delete this trade?");
            if (!ok) return;
            try {
              await db.collection("Users").doc(uid).collection("tradeCalls").doc(docId).delete();
            } catch (err) {
              alert("Delete failed: " + err.message);
            }
          });
        }
      });

      actions.appendChild(saveBtn);
      actions.appendChild(cancelBtn);
    }

    // Note: if you want custom access control (so only owner can edit/delete),
    // configure Firestore security rules accordingly in Firebase console:
    // e.g. only allow read/write where request.auth.uid == resource.data.createdBy

    // --- End of script
  </script>
</body>
</html>
